<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Troubleshooting</title><link rel="stylesheet" href="../assets/css/documentation.css"></head><body><header class="header"><div class="header-content"><h1>üõ†Ô∏è Troubleshooting</h1><nav class="header-nav"><a href="../index.html">Home</a></nav></div></header><div class="container"><aside class="sidebar"><h3>Sections</h3><ul><li><a href="#common">Common issues</a></li><li><a href="#debug">Debug steps</a></li><li><a href="#logs">Logs</a></li></ul></aside><main class="main-content"><div class="breadcrumbs"><a href="../index.html">Home</a> <span>/</span> Troubleshooting</div>
<h2 id="common">Common Issues</h2><ul><li><strong>Build fails:</strong> check missing env vars; run `pnpm typecheck`.</li><li><strong>Double bookings:</strong> ensure booking uses `generateNextTokenAndReserveSlot`; verify `slot-reservations` cleanup.</li><li><strong>Notifications not sent:</strong> missing FCM token or notificationsEnabled=false; route `/api/send-notification` response.</li><li><strong>Twilio errors:</strong> verify `TWILIO_*` env; WhatsApp opt-in error code 21612 handled with message.</li><li><strong>Firestore permission denied:</strong> user role not clinicAdmin; security rules not updated.</li></ul>

<h2 id="debug">Debug Procedures</h2><ul><li>Enable DEBUG flags: `NEXT_PUBLIC_DEBUG_BOOKING` to log booking flow.</li><li>Check Firestore documents for slot-reservations/token-counters consistency.</li><li>Use console logs in services (present throughout shared-core) to trace.</li><li>Re-run status updater manually: `updateAppointmentAndDoctorStatuses(clinicId)` in a script or server action.</li></ul>

<h2 id="logs">Log Locations</h2><ul><li>Browser console for frontend errors and booking debug logs.</li><li>Vercel function logs for API routes (send-sms, upload-avatar/doc).</li><li>Firebase console for Firestore rule denials.</li></ul>
<div class="alert alert-warning">If unexpected data corruption occurs, stop writes and inspect token-counters/slot-reservations before retrying.</div>
</main></div><footer class="footer"><p>Kloqo Technical Documentation ¬© 2024</p></footer><a href="#top" id="back-to-top" class="back-to-top">‚Üë</a><script src="../assets/js/navigation.js"></script></body></html>